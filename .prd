# Coolify Deployment Analysis - Terminal Startup Issues

## Completed Work Items

- [x] Research Coolify CLI and setup
- [x] Connect to specified deployment using Coolify CLI
- [x] Retrieve logs from failed deployment
- [x] Identify terminal/webssh2 startup failure root causes
- [x] Fix Node.js binary path resolution in start.sh
- [x] Fix NPM_CONFIG_PREFIX conflict with NVM in start.sh
- [x] Unset NPM_CONFIG_PREFIX in custom_startup.sh
- [x] Remove NPM_CONFIG_PREFIX from webssh2 environment
- [x] Clean stale NPM_CONFIG_PREFIX from persistent .profile

## Remaining Work Items

- [ ] Push fixes and redeploy
- [ ] Verify supervisor starts cleanly
- [ ] Verify terminals open without NVM errors
- [ ] Confirm deployment is stable

## Root Causes Found and Fixed

### Issue 1: Node.js binary not in PATH
supervisor.log shows: `stdbuf: failed to run command '/usr/local/bin/node': No such file or directory`
**Fix:** Source NVM in start.sh before running `which node`

### Issue 2: NPM_CONFIG_PREFIX conflicts with NVM
When opening terminals, repeated error: `nvm is not compatible with the "NPM_CONFIG_PREFIX" environment variable`
**Fix:** 
- Unset NPM_CONFIG_PREFIX in start.sh (early, before NVM loads)
- Unset NPM_CONFIG_PREFIX in custom_startup.sh
- Remove NPM_CONFIG_PREFIX from webssh2 shell environment
- Clean stale NPM_CONFIG_PREFIX from persistent .profile

## Files Modified

- startup/start.sh: Added NVM source + NPM_CONFIG_PREFIX unset
- docker/custom_startup.sh: Unset NPM_CONFIG_PREFIX early, clean from .profile
- startup/services/webssh2.js: Remove NPM_CONFIG_PREFIX from spawned bash environment

## Deployment Reference
URL: https://coolify.acc.l-inc.co.za/project/vwocgo84c0gwkg0gwc8sck8w/environment/z4gwo0ggg4o8ck0c4484wso4/application/zkc880sc40wgkssw44840g88
