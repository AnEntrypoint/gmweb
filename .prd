.prd: Final deployment verification and live domain testing

GOAL: Deploy WebRTC-enabled gmweb and verify it works on https://buildesk.acc.l-inc.co.za/desk/

COMMITS READY FOR DEPLOYMENT:
- 11630da: Fix: Include patch-selkies-webrtc.sh in Docker image for WebRTC mode activation (NEW - CRITICAL FIX)
- 1950c32: Enable Selkies WebRTC mode for efficient desktop streaming
- b1a99d4: Fix critical NPM_CONFIG_PREFIX conflict with NVM
- c2419d4: Clear .prd - nginx /desk simplification and version-check service complete
- 3fbc06c: Add version-check service for automatic bunx-based service updates
- 91ccfed: Simplify /desk nginx configuration - proxy ALL paths directly to Selkies

STATUS UPDATE - FEBRUARY 6, 2026:
- ISSUE FOUND: Dockerfile was not copying patch-selkies-webrtc.sh to /custom-cont-init.d/
- ROOT CAUSE: Startup script expects the patch file but it wasn't included in Docker image
- CONSEQUENCE: Selkies stayed in WebSocket mode instead of switching to WebRTC
- FIX APPLIED: Added COPY and chmod commands to Dockerfile (commit 11630da)
- NEXT STEP: Docker rebuild required to include patch script

EXECUTION ITEMS (dependency chain):

Item 1: Verify Docker build with new changes
  - Verify: Latest commits in origin/main
  - Run: docker-compose build gmweb
  - Verify: Build succeeds without errors
  - Check: All startup scripts copied to image
  - Check: patch-selkies-webrtc.sh executable
  - BLOCKS: Item 2
  - BLOCKED BY: none

Item 2: Deploy to live domain
  - Run: docker-compose up -d gmweb (or equivalent deploy command)
  - Verify: Container starts successfully
  - Monitor: Initial startup sequence
  - Check: No startup errors in logs
  - Wait: ~90 seconds for full startup
  - BLOCKS: Item 3
  - BLOCKED BY: Item 1

Item 3: Verify startup logs for WebRTC patch
  - Check: "✓ Selkies patched to WebRTC mode" in logs
  - Check: "✓ Selkies WebRTC patch applied" in logs
  - Check: NO "ERROR: npm not available" in logs
  - Check: "npm_config_prefix" unset messages
  - Check: supervisor started and services running
  - Verify: No startup failures or warnings
  - BLOCKS: Item 4
  - BLOCKED BY: Item 2

Item 4: Verify local system health (before external testing)
  - Run: ps aux | grep selkies (verify process running with --mode="webrtc")
  - Run: netstat -tlnp | grep 8082 (verify Selkies listening)
  - Run: curl -I http://localhost/desk/ (verify endpoint responds)
  - Check: Status code (should be 200 or 101 WebSocket upgrade)
  - Run: supervisorctl status (verify services running)
  - Check: No services in FATAL or failed state
  - BLOCKS: Item 5
  - BLOCKED BY: Item 3

Item 5: Test /desk on live domain HTTPS
  - Navigate to: https://buildesk.acc.l-inc.co.za/desk/
  - Verify: Page loads (not 426, not error)
  - Verify: Selkies WebRTC interface appears
  - Open: Browser DevTools → Console
  - Check: No console errors
  - Check: No permission errors (CORS, auth, etc.)
  - Monitor: Network tab for WebRTC connections
  - Verify: Connection established (no failed connections)
  - BLOCKS: Item 6
  - BLOCKED BY: Item 4

Item 6: Test Selkies functionality on live domain
  - Verify: Desktop video stream visible
  - Test: Mouse movement responsive
  - Test: Keyboard input working
  - Test: Can interact with desktop
  - Monitor: No disconnections or reconnections
  - Monitor: Stable WebRTC connection (Network tab)
  - Check: Video quality and frame rate good
  - BLOCKS: Item 7
  - BLOCKED BY: Item 5

Item 7: Verify no regressions on other endpoints
  - Test: https://buildesk.acc.l-inc.co.za/ (root, AionUI)
  - Test: https://buildesk.acc.l-inc.co.za/files/ (file-manager with auth)
  - Test: https://buildesk.acc.l-inc.co.za/ssh/ (webssh2 with auth)
  - Test: https://buildesk.acc.l-inc.co.za/gm/ (AgentGUI with auth)
  - Verify: All endpoints respond correctly
  - Verify: HTTP Basic Auth working on protected endpoints
  - Verify: /desk no longer requires auth (auth_basic off)
  - BLOCKS: Item 8
  - BLOCKED BY: Item 6

Item 8: Final verification and cleanup
  - Verify: All systems operational
  - Verify: No errors in system logs
  - Verify: npm cache clean (no permission issues)
  - Verify: supervisor health checks passing
  - Verify: version-check service running (if enabled)
  - Document: Final status
  - BLOCKS: nothing
  - BLOCKED BY: Item 7

PARALLEL OPPORTUNITIES:
- Items 1-7 are sequential (each depends on previous)
- Item 8 is final verification

ACCEPTANCE CRITERIA - ALL MUST BE TRUE:
✓ Docker image builds without errors
✓ Container deploys successfully
✓ Startup logs show WebRTC patch applied
✓ No npm errors in startup sequence
✓ Supervisor and services running
✓ Selkies process shows --mode="webrtc"
✓ https://buildesk.acc.l-inc.co.za/desk/ loads and responds
✓ Selkies WebRTC interface visible in browser
✓ No console errors in DevTools
✓ Desktop video stream visible and responsive
✓ Mouse/keyboard input working
✓ WebRTC connection stable (Network tab shows active connection)
✓ Other endpoints (/files/, /ssh/, /gm/) still working
✓ HTTP Basic Auth working on protected endpoints
✓ No startup errors or warnings in logs
✓ System stable for extended time

EXECUTION MODE: Real deployment to production domain, real browser testing, witnessed verification

GATE CONDITION: User can access https://buildesk.acc.l-inc.co.za/desk/, see video stream, interact with desktop, and confirm WebRTC working
